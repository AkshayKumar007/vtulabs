; hardware program, logic controller interface
INITDS MACRO
	MOV AX,@DATA
	MOV DS,AX
ENDM

INIT8255 MACRO
	MOV AL,CW	; INITIALISATION OF 8255 USING CONTROL WORD
	MOV DX,CR 	; CONTROL REGISTER
	OUT DX,AL
ENDM

OUTPA MACRO
	MOV DX,PA 		; PORT A
	OUT DX,AL
ENDM

DISPLAY MACRO MSG
	LEA DX,MSG
	MOV AH,9
	INT 21H
ENDM

EXIT1 MACRO
	MOV AH,4CH
	INT 21H
ENDM

.MODEL SMALL
.STACK
.DATA
	PA EQU 1C60H 		; ADDRESS OF PORT A
	CR EQU 1C63H 		; STORE CONTROL WORD ADDRESS IN CONTROL REGISTER
	CW DB 82H 			; PROGRAMMING CONTROL WORD

	MSG DB 10,13,'PRESS ANY KEY TO EXIT $'

.CODE
	INITDS
	INIT8255

	DISPLAY MSG

	MOV AL,0 			; INITIAL VALUE OF COUNTER IS 0

UP: OUTPA 				; DISPLAYS THE CONTENTS OF AL ON THE LOGIC MODULE

	CALL DELAY
	CALL KBHIT 			; CHECKS FOR KEYBOARD HIT

	ADD AL,1 			; INCREMENT VALUE
	DAA 				; DECIMAL ADJUST AFTER ADDITION

	CMP AL,99H 			; COUNT TILL 99
	JNE UP

DOWN:	OUTPA

		CALL DELAY
		CALL KBHIT

		ADD AL,99H 		; BY ADDING 99 IT WILL DECREMENT THE COUNT, 99+99 = 198
		DAA

		CMP AL,99H
		JNE DOWN

		EXIT1

DELAY PROC
	MOV BX,4FFFH

B2:	MOV CX,FFFFH
B1: LOOP B1
	DEC BX
	JNZ B2

	RET
DELAY ENDP

KBHIT PROC

	PUSH AX 		; SAVE VALUE OF AX TO STACK

	MOV AH,1 		; CHECKS FOR KEY PRESS
	INT 16H

	JNZ DONE
	POP AX 			; RETRIVE VALUE OF AX FROM STACK
	RET

DONE: EXIT1
KBHIT ENDP

END

; execute using the following command: iopm 0x1c60 bcd.asm
; then: debug bcd.exe